<html>
<header>
<title>sample</title>
<script src="signalclient.js" type="text/javascript"></script>
<script src="caller.js" type="text/javascript"></script>
<script src="signalpeer.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
var _mSignalPeer = null;
var v = new function() {
   this.onJoinNetwork = function(peer,v) {
   		console.log("joinNetwork():------------------------");
 		// create button
		var elm = document.createElement("button");
		elm.textContent = "[server] "+v.from;
		var offerList = document.getElementById("offerlist");
		elm.setAttribute("onclick", "onPushSendOffer(\"init\");");
		elm.setAttribute("value", v.from);
		offerList.appendChild(elm);		
   };

   this.onReceiveMessage = function(peer, v) {
   		var p2pMes = JSON.parse(v);
   		console.log("onReceiveMessage:------------------------");
   		if("response" === p2pMes.type) {
	    	if("findnode" === p2pMes.command) {
 		// create button
		var elm = document.createElement("button");
		elm.textContent = "[peer"+p2pMes.from+"] "+p2pMes.node["node0"];
		var offerList = document.getElementById("offerlist");
		elm.setAttribute("onclick", "onPushSendOffer(\""+p2pMes.from+"\");");
		elm.setAttribute("value", v.from);
		offerList.appendChild(elm);
	    	}
	    }
   };
};

window.onload = function() {
	_mSignalPeer = new SignalPeer("ws://localhost:8080");
	_mSignalPeer.setEventListener(v);
}

function onPushSendJoin() {
	console.log("onPushSendJoin()");
    _mSignalPeer.joinNetwork();
}

function onPushSendOffer(type) {
    console.log("onPushSendOffer()"+event.srcElement.value+","+type);
    var uuid = event.srcElement.value;
    _mSignalPeer.sendOffer(uuid);
}

function onPushSendHello() {
    console.log("onPushSendHello()");
    _mSignalPeer.sendHello(JSON.stringify(v));
}


//-->
</script>
</header>
<body>
<label id="uuid">uuid_value</label><br><br>
<button id="join" onclick="onPushSendJoin();">join network(server)</button><br><br>
<button id="hello" onclick="onPushSendHello();">sendHello</button><br><br>

<br>
<div id="offerlist">
<h3>[PeerList]</h3>
</div>


</body>
</html>

