<html>
<header>
<title>sample</title>
<script src="gui/testgui.js" type="text/javascript"></script>
<script src="signal/signalclient.js" type="text/javascript"></script>
<script src="caller/caller.js" type="text/javascript"></script>
<script src="caller/callerinfo.js" type="text/javascript"></script>
<script src="peer/signalpeer.js" type="text/javascript"></script>
<script src="util/uuid.njs" type="text/javascript"></script>
<script src="peer/messagetransfer.js" type="text/javascript"></script>
<script src="peer/messageprotocol.js" type="text/javascript"></script>

<script type="text/javascript">
<!--
var _mSignalPeer = null;
var v = new function() {
   this.onJoinNetwork = function(peer,v) {
   		console.log("joinNetwork():------------"+v.from+"------------");
   		if(v.from === _mSignalPeer.getUUID()) {
   			return;
   		}
 		// create button
		addLabel("offerlist", "[server] "+v.from);
		addBr("offerlist");
		addButton("offerlist","offer","onPushSendOffer(\"server\");", v.from);
		addBr("offerlist");
		addButton("offerlist","findnode","onPushFindNode(\""+v.from+"\");", v.from);
		addBr("offerlist");
		addBr("offerlist");
   };

   this.onReceiveMessage = function(peer, v) {
   		console.log("onReceiveMessage:------------------------");

   		if("response" === v.type) {
	    	if("findnode" === v.command) {
	    	   	if(_mSignalPeer.getUUID() === v.node["node0"]) {
   					return;
   				}
 				// create button
				addLabel("offerlist", "[peer"+v.from+"] "+v.node["node0"]);
				addBr("offerlist");
				addButton("offerlist","offer","onPushSendOffer(\""+v.from+"\");", v.from);
				addBr("offerlist");
				addButton("offerlist","findnode","onPushFindNode(\""+v.from+"\");", v.from);
				addBr("offerlist");
				addBr("offerlist");
	    	}
	    }
   };
};

window.onload = function() {
	_mSignalPeer = new SignalPeer("ws://localhost:8080");
	_mSignalPeer.setEventListener(v);
}

function onPushSendJoin() {
	console.log("onPushSendJoin()");
    _mSignalPeer.joinNetwork();
}

function onPushSendOffer(type) {
    console.log("onPushSendOffer()"+event.srcElement.value+","+type);
    var uuid = event.srcElement.value;
    if("server" == type) { 
    	_mSignalPeer.sendOffer(uuid);
    } else {
    	_mSignalPeer.sendOffer(uuid);    	
    }
}

function onPushFindNode(uuid) {
    console.log("onPushFindNode():"+uuid);
    _mSignalPeer.getMessageProtocol().sendFindNode(uuid);
}


function onPushSendHello() {
    console.log("onPushSendHello()");
    _mSignalPeer.sendHello(JSON.stringify(v));
}


//-->
</script>
</header>
<body>
<label id="uuid">uuid_value</label><br><br>
<button id="join" onclick="onPushSendJoin();">join network(server)</button><br><br>
<br>
<div id="offerlist">
<h3>[PeerList]</h3>
</div>


</body>
</html>

